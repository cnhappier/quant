使用说明

上次发布了一系列的绩效函数，后来自己看了一下，发现要用到别的策略里去还是有些麻烦，于是动手进行了一些简化，将所有代码封装成了一个独立的 MyTrader 类，里面封装了大部分我们在聚宽编写策略时反复要用到的一些功能，使用起来比直接调用聚宽的 api 更简单，诸如 按比例自动调仓、自动平均调仓等功能。

具体使用方法，在研究下面新建一个 MyTrader.py 文件，然后将下面代码复制到该文件，之后只要在你的策略代码的顶部 使用 from MyTrader import MyTrader 即可引入，然后在策略代码开始的第一行 加上 trader = MyTrader(context, g) 就行了，很简单。

重点 推荐 buy_amount() 函数，你们可以试试加到自己的策略里去，不少策略回测的效果会有显著提升哦 -v- ，其他的，看代码注释就好了，很易用。

===================
buy_value()、sell_value()、buy_amount()、sell_amount() 都是对官方现有的 order 系列的包装，所不同的是这buy_value() 函数买入时会更积极，怎么理解呢？比如有时候看日志，你经常能看到 买入 180 股被系统重置为 100 股，但是实际上我们既然要买，肯定会倾向买入 200 股，实际测试的时候我也发现，相同策略改用 buy_value() 后回测的收益会比 用 order 系列函数高不少。

以下是代码举例：

buy_value('000001.XSHE', 10000)
买入 10000 元 中国银行

buy_amount('000001.XSHE', 100)
买入 100 股 平安银行

sell_value('000001.XSHE', 10000)
卖出 10000 元的 平安银行，如果第二个参数为0，则会直接清空 平安银行 的持仓

sell_amount('000001.XSHE', 100)
卖出 100 股的 平安银行，如果第二个参数为0，则会直接清空 平安银行 的持仓

adjust_target_percent('000001.XSHE', 0.5)
将当前持有的 平安银行 仓位调整为当前总金额的 50%（总金额=持仓市值+可用资金），假设当前平安银行的持仓总值为60%，那么就会卖出 10% 的股票，如果是 40%，则会买入 10%，总之会尽量保证仓位为 50%，这里要注意，是尽量，不是一定会，因为有时候你可能钱不够，买不到。
第二个参数为0的话就直接清空该股票仓位

adjust_target_value('000001.XSHE', 10000)
类似上面的函数，会将 中国平安 的持仓总额调整到 10000元左右

adjust_auto_avg()
这个函数不接受任何参数，会自动根据持仓股票数量动态计算每只股票的目标仓位，然后多出的卖掉，少了的买入，反正会尽量让他们仓位保持均衡。

以上就是几个比较关键的函数用法，剩下的那些用的机会少，看参数也能明白是干什么的，我就不多写了。

ubstoo 发布于2016-04-24
https://www.joinquant.com/post/1171
